74b987d1a44adc079a64920cf41bc700
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it; if (typeof Symbol === "undefined" || o[typeof Symbol === "function" ? Symbol.iterator : "@@iterator"] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } it = o[typeof Symbol === "function" ? Symbol.iterator : "@@iterator"](); return it.next.bind(it); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

var YellowBoxWarning = require("./YellowBoxWarning");

var observers = new Set();
var ignorePatterns = new Set();
var registry = new Map();
var disabled = false;
var projection = new Map();
var updateTimeout = null;

function isWarningIgnored(warning) {
  for (var _iterator = _createForOfIteratorHelperLoose(ignorePatterns), _step; !(_step = _iterator()).done;) {
    var pattern = _step.value;

    if (pattern instanceof RegExp && pattern.test(warning.message.content)) {
      return true;
    } else if (typeof pattern === 'string' && warning.message.content.includes(pattern)) {
      return true;
    }
  }

  return false;
}

function handleUpdate() {
  projection = new Map();

  if (!disabled) {
    for (var _iterator2 = _createForOfIteratorHelperLoose(registry), _step2; !(_step2 = _iterator2()).done;) {
      var _ref = _step2.value;

      var _ref2 = (0, _slicedToArray2.default)(_ref, 2);

      var category = _ref2[0];
      var warnings = _ref2[1];
      var filtered = warnings.filter(function (warning) {
        return !isWarningIgnored(warning);
      });

      if (filtered.length > 0) {
        projection.set(category, filtered);
      }
    }
  }

  if (updateTimeout == null) {
    updateTimeout = setImmediate(function () {
      updateTimeout = null;

      for (var _iterator3 = _createForOfIteratorHelperLoose(observers), _step3; !(_step3 = _iterator3()).done;) {
        var _ref3 = _step3.value;
        var observer = _ref3.observer;
        observer(projection);
      }
    });
  }
}

var YellowBoxRegistry = {
  add: function add(_ref4) {
    var args = _ref4.args,
        framesToPop = _ref4.framesToPop;

    if (typeof args[0] === 'string' && args[0].startsWith('(ADVICE)')) {
      return;
    }

    var _YellowBoxWarning$par = YellowBoxWarning.parse({
      args: args,
      framesToPop: framesToPop + 1
    }),
        category = _YellowBoxWarning$par.category,
        message = _YellowBoxWarning$par.message,
        stack = _YellowBoxWarning$par.stack;

    var warnings = registry.get(category);

    if (warnings == null) {
      warnings = [];
    }

    warnings = [].concat((0, _toConsumableArray2.default)(warnings), [new YellowBoxWarning(message, stack)]);
    registry.delete(category);
    registry.set(category, warnings);
    handleUpdate();
  },
  delete: function _delete(category) {
    if (registry.has(category)) {
      registry.delete(category);
      handleUpdate();
    }
  },
  clear: function clear() {
    if (registry.size > 0) {
      registry.clear();
      handleUpdate();
    }
  },
  addIgnorePatterns: function addIgnorePatterns(patterns) {
    var newPatterns = patterns.filter(function (pattern) {
      if (pattern instanceof RegExp) {
        for (var _iterator4 = _createForOfIteratorHelperLoose(ignorePatterns.entries()), _step4; !(_step4 = _iterator4()).done;) {
          var existingPattern = _step4.value;

          if (existingPattern instanceof RegExp && existingPattern.toString() === pattern.toString()) {
            return false;
          }
        }

        return true;
      }

      return !ignorePatterns.has(pattern);
    });

    if (newPatterns.length === 0) {
      return;
    }

    for (var _iterator5 = _createForOfIteratorHelperLoose(newPatterns), _step5; !(_step5 = _iterator5()).done;) {
      var pattern = _step5.value;
      ignorePatterns.add(pattern);
    }

    handleUpdate();
  },
  setDisabled: function setDisabled(value) {
    if (value === disabled) {
      return;
    }

    disabled = value;
    handleUpdate();
  },
  isDisabled: function isDisabled() {
    return disabled;
  },
  observe: function observe(observer) {
    var subscription = {
      observer: observer
    };
    observers.add(subscription);
    observer(projection);
    return {
      unsubscribe: function unsubscribe() {
        observers.delete(subscription);
      }
    };
  }
};
module.exports = YellowBoxRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlllbGxvd0JveFJlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbIlllbGxvd0JveFdhcm5pbmciLCJyZXF1aXJlIiwib2JzZXJ2ZXJzIiwiU2V0IiwiaWdub3JlUGF0dGVybnMiLCJyZWdpc3RyeSIsIk1hcCIsImRpc2FibGVkIiwicHJvamVjdGlvbiIsInVwZGF0ZVRpbWVvdXQiLCJpc1dhcm5pbmdJZ25vcmVkIiwid2FybmluZyIsInBhdHRlcm4iLCJSZWdFeHAiLCJ0ZXN0IiwibWVzc2FnZSIsImNvbnRlbnQiLCJpbmNsdWRlcyIsImhhbmRsZVVwZGF0ZSIsImNhdGVnb3J5Iiwid2FybmluZ3MiLCJmaWx0ZXJlZCIsImZpbHRlciIsImxlbmd0aCIsInNldCIsInNldEltbWVkaWF0ZSIsIm9ic2VydmVyIiwiWWVsbG93Qm94UmVnaXN0cnkiLCJhZGQiLCJhcmdzIiwiZnJhbWVzVG9Qb3AiLCJzdGFydHNXaXRoIiwicGFyc2UiLCJzdGFjayIsImdldCIsImRlbGV0ZSIsImhhcyIsImNsZWFyIiwic2l6ZSIsImFkZElnbm9yZVBhdHRlcm5zIiwicGF0dGVybnMiLCJuZXdQYXR0ZXJucyIsImVudHJpZXMiLCJleGlzdGluZ1BhdHRlcm4iLCJ0b1N0cmluZyIsInNldERpc2FibGVkIiwidmFsdWUiLCJpc0Rpc2FibGVkIiwib2JzZXJ2ZSIsInN1YnNjcmlwdGlvbiIsInVuc3Vic2NyaWJlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsZ0JBQWdCLEdBQUdDLE9BQU8sc0JBQWhDOztBQWNBLElBQU1DLFNBQW9DLEdBQUcsSUFBSUMsR0FBSixFQUE3QztBQUNBLElBQU1DLGNBQWtDLEdBQUcsSUFBSUQsR0FBSixFQUEzQztBQUNBLElBQU1FLFFBQWtCLEdBQUcsSUFBSUMsR0FBSixFQUEzQjtBQUVBLElBQUlDLFFBQVEsR0FBRyxLQUFmO0FBQ0EsSUFBSUMsVUFBVSxHQUFHLElBQUlGLEdBQUosRUFBakI7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QUFrRXhCMkIsRUFBQUEsV0FsRXdCLHVCQWtFWkMsS0FsRVksRUFrRVU7QUFDaEMsUUFBSUEsS0FBSyxLQUFLdkMsUUFBZCxFQUF3QjtBQUN0QjtBQUNEOztBQUNEQSxJQUFBQSxRQUFRLEdBQUd1QyxLQUFYO0FBQ0E1QixJQUFBQSxZQUFZO0FBQ2IsR0F4RXVCO0FBMEV4QjZCLEVBQUFBLFVBMUV3Qix3QkEwRUY7QUFDcEIsV0FBT3hDLFFBQVA7QUFDRCxHQTVFdUI7QUE4RXhCeUMsRUFBQUEsT0E5RXdCLG1CQThFaEJ0QixRQTlFZ0IsRUE4RWtCO0FBQ3hDLFFBQU11QixZQUFZLEdBQUc7QUFBQ3ZCLE1BQUFBLFFBQVEsRUFBUkE7QUFBRCxLQUFyQjtBQUNBeEIsSUFBQUEsU0FBUyxDQUFDMEIsR0FBVixDQUFjcUIsWUFBZDtBQUNBdkIsSUFBQUEsUUFBUSxDQUFDbEIsVUFBRCxDQUFSO0FBQ0EsV0FBTztBQUNMMEMsTUFBQUEsV0FESyx5QkFDZTtBQUNsQmhELFFBQUFBLFNBQVMsQ0FBQ2lDLE1BQVYsQ0FBaUJjLFlBQWpCO0FBQ0Q7QUFISSxLQUFQO0FBS0Q7QUF2RnVCLENBQTFCO0FBMEZBRSxNQUFNLENBQUNDLE9BQVAsR0FBaUJ6QixpQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgWWVsbG93Qm94V2FybmluZyA9IHJlcXVpcmUoJy4vWWVsbG93Qm94V2FybmluZycpO1xuXG5pbXBvcnQgdHlwZSB7Q2F0ZWdvcnl9IGZyb20gJy4vWWVsbG93Qm94Q2F0ZWdvcnknO1xuXG5leHBvcnQgdHlwZSBSZWdpc3RyeSA9IE1hcDxDYXRlZ29yeSwgJFJlYWRPbmx5QXJyYXk8WWVsbG93Qm94V2FybmluZz4+O1xuXG5leHBvcnQgdHlwZSBPYnNlcnZlciA9IChyZWdpc3RyeTogUmVnaXN0cnkpID0+IHZvaWQ7XG5cbmV4cG9ydCB0eXBlIElnbm9yZVBhdHRlcm4gPSBzdHJpbmcgfCBSZWdFeHA7XG5cbmV4cG9ydCB0eXBlIFN1YnNjcmlwdGlvbiA9ICRSZWFkT25seTx7fFxuICB1bnN1YnNjcmliZTogKCkgPT4gdm9pZCxcbnx9PjtcblxuY29uc3Qgb2JzZXJ2ZXJzOiBTZXQ8e29ic2VydmVyOiBPYnNlcnZlcn0+ID0gbmV3IFNldCgpO1xuY29uc3QgaWdub3JlUGF0dGVybnM6IFNldDxJZ25vcmVQYXR0ZXJuPiA9IG5ldyBTZXQoKTtcbmNvbnN0IHJlZ2lzdHJ5OiBSZWdpc3RyeSA9IG5ldyBNYXAoKTtcblxubGV0IGRpc2FibGVkID0gZmFsc2U7XG5sZXQgcHJvamVjdGlvbiA9IG5ldyBNYXAoKTtcbmxldCB1cGRhdGVUaW1lb3V0ID0gbnVsbDtcblxuZnVuY3Rpb24gaXNXYXJuaW5nSWdub3JlZCh3YXJuaW5nOiBZZWxsb3dCb3hXYXJuaW5nKTogYm9vbGVhbiB7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBpZ25vcmVQYXR0ZXJucykge1xuICAgIGlmIChwYXR0ZXJuIGluc3RhbmNlb2YgUmVnRXhwICYmIHBhdHRlcm4udGVzdCh3YXJuaW5nLm1lc3NhZ2UuY29udGVudCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICB0eXBlb2YgcGF0dGVybiA9PT0gJ3N0cmluZycgJiZcbiAgICAgIHdhcm5pbmcubWVzc2FnZS5jb250ZW50LmluY2x1ZGVzKHBhdHRlcm4pXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVVcGRhdGUoKTogdm9pZCB7XG4gIHByb2plY3Rpb24gPSBuZXcgTWFwKCk7XG4gIGlmICghZGlzYWJsZWQpIHtcbiAgICBmb3IgKGNvbnN0IFtjYXRlZ29yeSwgd2FybmluZ3NdIG9mIHJlZ2lzdHJ5KSB7XG4gICAgICBjb25zdCBmaWx0ZXJlZCA9IHdhcm5pbmdzLmZpbHRlcih3YXJuaW5nID0+ICFpc1dhcm5pbmdJZ25vcmVkKHdhcm5pbmcpKTtcbiAgICAgIGlmIChmaWx0ZXJlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByb2plY3Rpb24uc2V0KGNhdGVnb3J5LCBmaWx0ZXJlZCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmICh1cGRhdGVUaW1lb3V0ID09IG51bGwpIHtcbiAgICB1cGRhdGVUaW1lb3V0ID0gc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgIHVwZGF0ZVRpbWVvdXQgPSBudWxsO1xuICAgICAgZm9yIChjb25zdCB7b2JzZXJ2ZXJ9IG9mIG9ic2VydmVycykge1xuICAgICAgICBvYnNlcnZlcihwcm9qZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5jb25zdCBZZWxsb3dCb3hSZWdpc3RyeSA9IHtcbiAgYWRkKHtcbiAgICBhcmdzLFxuICAgIGZyYW1lc1RvUG9wLFxuICB9OiAkUmVhZE9ubHk8e3xcbiAgICBhcmdzOiAkUmVhZE9ubHlBcnJheTxtaXhlZD4sXG4gICAgZnJhbWVzVG9Qb3A6IG51bWJlcixcbiAgfH0+KTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJyAmJiBhcmdzWzBdLnN0YXJ0c1dpdGgoJyhBRFZJQ0UpJykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qge2NhdGVnb3J5LCBtZXNzYWdlLCBzdGFja30gPSBZZWxsb3dCb3hXYXJuaW5nLnBhcnNlKHtcbiAgICAgIGFyZ3MsXG4gICAgICBmcmFtZXNUb1BvcDogZnJhbWVzVG9Qb3AgKyAxLFxuICAgIH0pO1xuXG4gICAgbGV0IHdhcm5pbmdzID0gcmVnaXN0cnkuZ2V0KGNhdGVnb3J5KTtcbiAgICBpZiAod2FybmluZ3MgPT0gbnVsbCkge1xuICAgICAgd2FybmluZ3MgPSBbXTtcbiAgICB9XG4gICAgd2FybmluZ3MgPSBbLi4ud2FybmluZ3MsIG5ldyBZZWxsb3dCb3hXYXJuaW5nKG1lc3NhZ2UsIHN0YWNrKV07XG5cbiAgICByZWdpc3RyeS5kZWxldGUoY2F0ZWdvcnkpO1xuICAgIHJlZ2lzdHJ5LnNldChjYXRlZ29yeSwgd2FybmluZ3MpO1xuXG4gICAgaGFuZGxlVXBkYXRlKCk7XG4gIH0sXG5cbiAgZGVsZXRlKGNhdGVnb3J5OiBDYXRlZ29yeSk6IHZvaWQge1xuICAgIGlmIChyZWdpc3RyeS5oYXMoY2F0ZWdvcnkpKSB7XG4gICAgICByZWdpc3RyeS5kZWxldGUoY2F0ZWdvcnkpO1xuICAgICAgaGFuZGxlVXBkYXRlKCk7XG4gICAgfVxuICB9LFxuXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIGlmIChyZWdpc3RyeS5zaXplID4gMCkge1xuICAgICAgcmVnaXN0cnkuY2xlYXIoKTtcbiAgICAgIGhhbmRsZVVwZGF0ZSgpO1xuICAgIH1cbiAgfSxcblxuICBhZGRJZ25vcmVQYXR0ZXJucyhwYXR0ZXJuczogJFJlYWRPbmx5QXJyYXk8SWdub3JlUGF0dGVybj4pOiB2b2lkIHtcbiAgICBjb25zdCBuZXdQYXR0ZXJucyA9IHBhdHRlcm5zLmZpbHRlcigocGF0dGVybjogSWdub3JlUGF0dGVybikgPT4ge1xuICAgICAgaWYgKHBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgZm9yIChjb25zdCBleGlzdGluZ1BhdHRlcm4gb2YgaWdub3JlUGF0dGVybnMuZW50cmllcygpKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgZXhpc3RpbmdQYXR0ZXJuIGluc3RhbmNlb2YgUmVnRXhwICYmXG4gICAgICAgICAgICBleGlzdGluZ1BhdHRlcm4udG9TdHJpbmcoKSA9PT0gcGF0dGVybi50b1N0cmluZygpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuICFpZ25vcmVQYXR0ZXJucy5oYXMocGF0dGVybik7XG4gICAgfSk7XG4gICAgaWYgKG5ld1BhdHRlcm5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgbmV3UGF0dGVybnMpIHtcbiAgICAgIGlnbm9yZVBhdHRlcm5zLmFkZChwYXR0ZXJuKTtcbiAgICB9XG4gICAgaGFuZGxlVXBkYXRlKCk7XG4gIH0sXG5cbiAgc2V0RGlzYWJsZWQodmFsdWU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodmFsdWUgPT09IGRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGRpc2FibGVkID0gdmFsdWU7XG4gICAgaGFuZGxlVXBkYXRlKCk7XG4gIH0sXG5cbiAgaXNEaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZGlzYWJsZWQ7XG4gIH0sXG5cbiAgb2JzZXJ2ZShvYnNlcnZlcjogT2JzZXJ2ZXIpOiBTdWJzY3JpcHRpb24ge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHtvYnNlcnZlcn07XG4gICAgb2JzZXJ2ZXJzLmFkZChzdWJzY3JpcHRpb24pO1xuICAgIG9ic2VydmVyKHByb2plY3Rpb24pO1xuICAgIHJldHVybiB7XG4gICAgICB1bnN1YnNjcmliZSgpOiB2b2lkIHtcbiAgICAgICAgb2JzZXJ2ZXJzLmRlbGV0ZShzdWJzY3JpcHRpb24pO1xuICAgICAgfSxcbiAgICB9O1xuICB9LFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBZZWxsb3dCb3hSZWdpc3RyeTtcbiJdfQ==