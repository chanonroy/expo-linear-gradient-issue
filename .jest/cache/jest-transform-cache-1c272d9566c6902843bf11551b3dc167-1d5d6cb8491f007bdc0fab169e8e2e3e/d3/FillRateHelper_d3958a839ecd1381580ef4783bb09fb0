763337d2d9d53fe9f14a0f35ff2268c3
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var performanceNow = require('fbjs/lib/performanceNow');

var warning = require('fbjs/lib/warning');

var Info = function Info() {
  (0, _classCallCheck2.default)(this, Info);
  this.any_blank_count = 0;
  this.any_blank_ms = 0;
  this.any_blank_speed_sum = 0;
  this.mostly_blank_count = 0;
  this.mostly_blank_ms = 0;
  this.pixels_blank = 0;
  this.pixels_sampled = 0;
  this.pixels_scrolled = 0;
  this.total_time_spent = 0;
  this.sample_count = 0;
};

var DEBUG = false;
var _listeners = [];
var _minSampleCount = 10;

var _sampleRate = DEBUG ? 1 : null;

var FillRateHelper = function () {
  (0, _createClass2.default)(FillRateHelper, null, [{
    key: "addListener",
    value: function addListener(callback) {
      warning(_sampleRate !== null, 'Call `FillRateHelper.setSampleRate` before `addListener`.');

      _listeners.push(callback);

      return {
        remove: function remove() {
          _listeners = _listeners.filter(function (listener) {
            return callback !== listener;
          });
        }
      };
    }
  }, {
    key: "setSampleRate",
    value: function setSampleRate(sampleRate) {
      _sampleRate = sampleRate;
    }
  }, {
    key: "setMinSampleCount",
    value: function setMinSampleCount(minSampleCount) {
      _minSampleCount = minSampleCount;
    }
  }]);

  function FillRateHelper(getFrameMetrics) {
    (0, _classCallCheck2.default)(this, FillRateHelper);
    this._anyBlankStartTime = null;
    this._enabled = false;
    this._info = new Info();
    this._mostlyBlankStartTime = null;
    this._samplesStartTime = null;
    this._getFrameMetrics = getFrameMetrics;
    this._enabled = (_sampleRate || 0) > Math.random();

    this._resetData();
  }

  (0, _createClass2.default)(FillRateHelper, [{
    key: "activate",
    value: function activate() {
      if (this._enabled && this._samplesStartTime == null) {
        DEBUG && console.debug('FillRateHelper: activate');
        this._samplesStartTime = performanceNow();
      }
    }
  }, {
    key: "deactivateAndFlush",
    value: function deactivateAndFlush() {
      if (!this._enabled) {
        return;
      }

      var start = this._samplesStartTime;

      if (start == null) {
        DEBUG && console.debug('FillRateHelper: bail on deactivate with no start time');
        return;
      }

      if (this._info.sample_count < _minSampleCount) {
        this._resetData();

        return;
      }

      var total_time_spent = performanceNow() - start;

      var info = _objectSpread(_objectSpread({}, this._info), {}, {
        total_time_spent: total_time_spent
      });

      if (DEBUG) {
        var derived = {
          avg_blankness: this._info.pixels_blank / this._info.pixels_sampled,
          avg_speed: this._info.pixels_scrolled / (total_time_spent / 1000),
          avg_speed_when_any_blank: this._info.any_blank_speed_sum / this._info.any_blank_count,
          any_blank_per_min: this._info.any_blank_count / (total_time_spent / 1000 / 60),
          any_blank_time_frac: this._info.any_blank_ms / total_time_spent,
          mostly_blank_per_min: this._info.mostly_blank_count / (total_time_spent / 1000 / 60),
          mostly_blank_time_frac: this._info.mostly_blank_ms / total_time_spent
        };

        for (var key in derived) {
          derived[key] = Math.round(1000 * derived[key]) / 1000;
        }

        console.debug('FillRateHelper deactivateAndFlush: ', {
          derived: derived,
          info: info
        });
      }

      _listeners.forEach(function (listener) {
        return listener(info);
      });

      this._resetData();
    }
  }, {
    key: "computeBlankness",
    value: function computeBlankness(props, state, scrollMetrics) {
      if (!this._enabled || props.getItemCount(props.data) === 0 || this._samplesStartTime == null) {
        return 0;
      }

      var dOffset = scrollMetrics.dOffset,
          offset = scrollMetrics.offset,
          velocity = scrollMetrics.velocity,
          visibleLength = scrollMetrics.visibleLength;
      this._info.sample_count++;
      this._info.pixels_sampled += Math.round(visibleLength);
      this._info.pixels_scrolled += Math.round(Math.abs(dOffset));
      var scrollSpeed = Math.round(Math.abs(velocity) * 1000);
      var now = performanceNow();

      if (this._anyBlankStartTime != null) {
        this._info.any_blank_ms += now - this._anyBlankStartTime;
      }

      this._anyBlankStartTime = null;

      if (this._mostlyBlankStartTime != null) {
        this._info.mostly_blank_ms += now - this._mostlyBlankStartTime;
      }

      this._mostlyBlankStartTime = null;
      var blankTop = 0;
      var first = state.first;

      var firstFrame = this._getFrameMetrics(first);

      while (first <= state.last && (!firstFrame || !firstFrame.inLayout)) {
        firstFrame = this._getFrameMetrics(first);
        first++;
      }

      if (firstFrame && first > 0) {
        blankTop = Math.min(visibleLength, Math.max(0, firstFrame.offset - offset));
      }

      var blankBottom = 0;
      var last = state.last;

      var lastFrame = this._getFrameMetrics(last);

      while (last >= state.first && (!lastFrame || !lastFrame.inLayout)) {
        lastFrame = this._getFrameMetrics(last);
        last--;
      }

      if (lastFrame && last < props.getItemCount(props.data) - 1) {
        var bottomEdge = lastFrame.offset + lastFrame.length;
        blankBottom = Math.min(visibleLength, Math.max(0, offset + visibleLength - bottomEdge));
      }

      var pixels_blank = Math.round(blankTop + blankBottom);
      var blankness = pixels_blank / visibleLength;

      if (blankness > 0) {
        this._anyBlankStartTime = now;
        this._info.any_blank_speed_sum += scrollSpeed;
        this._info.any_blank_count++;
        this._info.pixels_blank += pixels_blank;

        if (blankness > 0.5) {
          this._mostlyBlankStartTime = now;
          this._info.mostly_blank_count++;
        }
      } else if (scrollSpeed < 0.01 || Math.abs(dOffset) < 1) {
        this.deactivateAndFlush();
      }

      return blankness;
    }
  }, {
    key: "enabled",
    value: function enabled() {
      return this._enabled;
    }
  }, {
    key: "_resetData",
    value: function _resetData() {
      this._anyBlankStartTime = null;
      this._info = new Info();
      this._mostlyBlankStartTime = null;
      this._samplesStartTime = null;
    }
  }]);
  return FillRateHelper;
}();

module.exports = FillRateHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZpbGxSYXRlSGVscGVyLmpzIl0sIm5hbWVzIjpbInBlcmZvcm1hbmNlTm93IiwicmVxdWlyZSIsIndhcm5pbmciLCJJbmZvIiwiYW55X2JsYW5rX2NvdW50IiwiYW55X2JsYW5rX21zIiwiYW55X2JsYW5rX3NwZWVkX3N1bSIsIm1vc3RseV9ibGFua19jb3VudCIsIm1vc3RseV9ibGFua19tcyIsInBpeGVsc19ibGFuayIsInBpeGVsc19zYW1wbGVkIiwicGl4ZWxzX3Njcm9sbGVkIiwidG90YWxfdGltZV9zcGVudCIsInNhbXBsZV9jb3VudCIsIkRFQlVHIiwiX2xpc3RlbmVycyIsIl9taW5TYW1wbGVDb3VudCIsIl9zYW1wbGVSYXRlIiwiRmlsbFJhdGVIZWxwZXIiLCJjYWxsYmFjayIsInB1c2giLCJyZW1vdmUiLCJmaWx0ZXIiLCJsaXN0ZW5lciIsInNhbXBsZVJhdGUiLCJtaW5TYW1wbGVDb3VudCIsImdldEZyYW1lTWV0cmljcyIsIl9hbnlCbGFua1N0YXJ0VGltZSIsIl9lbmFibGVkIiwiX2luZm8iLCJfbW9zdGx5QmxhbmtTdGFydFRpbWUiLCJfc2FtcGxlc1N0YXJ0VGltZSIsIl9nZXRGcmFtZU1ldHJpY3MiLCJNYXRoIiwicmFuZG9tIiwiX3Jlc2V0RGF0YSIsImNvbnNvbGUiLCJkZWJ1ZyIsInN0YXJ0IiwiaW5mbyIsImRlcml2ZWQiLCJhdmdfYmxhbmtuZXNzIiwiYXZnX3NwZWVkIiwiYXZnX3NwZWVkX3doZW5fYW55X2JsYW5rIiwiYW55X2JsYW5rX3Blcl9taW4iLCJhbnlfYmxhbmtfdGltZV9mcmFjIiwibW9zdGx5X2JsYW5rX3Blcl9taW4iLCJtb3N0bHlfYmxhbmtfdGltZV9mcmFjIiwia2V5Iiwicm91bmQiLCJmb3JFYWNoIiwicHJvcHMiLCJzdGF0ZSIsInNjcm9sbE1ldHJpY3MiLCJnZXRJdGVtQ291bnQiLCJkYXRhIiwiZE9mZnNldCIsIm9mZnNldCIsInZlbG9jaXR5IiwidmlzaWJsZUxlbmd0aCIsImFicyIsInNjcm9sbFNwZWVkIiwibm93IiwiYmxhbmtUb3AiLCJmaXJzdCIsImZpcnN0RnJhbWUiLCJsYXN0IiwiaW5MYXlvdXQiLCJtaW4iLCJtYXgiLCJibGFua0JvdHRvbSIsImxhc3RGcmFtZSIsImJvdHRvbUVkZ2UiLCJsZW5ndGgiLCJibGFua25lc3MiLCJkZWFjdGl2YXRlQW5kRmx1c2giLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQTs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxjQUFjLEdBQUdDLE9BQU8sQ0FBQyx5QkFBRCxDQUE5Qjs7QUFDQSxJQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxrQkFBRCxDQUF2Qjs7SUFJTUUsSTs7T0FDSkMsZSxHQUEwQixDO09BQzFCQyxZLEdBQXVCLEM7T0FDdkJDLG1CLEdBQThCLEM7T0FDOUJDLGtCLEdBQTZCLEM7T0FDN0JDLGUsR0FBMEIsQztPQUMxQkMsWSxHQUF1QixDO09BQ3ZCQyxjLEdBQXlCLEM7T0FDekJDLGUsR0FBMEIsQztPQUMxQkMsZ0IsR0FBMkIsQztPQUMzQkMsWSxHQUF1QixDOzs7QUFLekIsSUFBTUMsS0FBSyxHQUFHLEtBQWQ7QUFFQSxJQUFJQyxVQUFpQyxHQUFHLEVBQXhDO0FBQ0EsSUFBSUMsZUFBZSxHQUFHLEVBQXRCOztBQUNBLElBQUlDLFdBQVcsR0FBR0gsS0FBSyxHQUFHLENBQUgsR0FBTyxJQUE5Qjs7SUFVTUksYzs7O2dDQVFlQyxRLEVBQXNEO0FBQ3ZFakIsTUFBQUEsT0FBTyxDQUNMZSxXQUFXLEtBQUssSUFEWCxFQUVMLDJEQUZLLENBQVA7O0FBSUFGLE1BQUFBLFVBQVUsQ0FBQ0ssSUFBWCxDQUFnQkQsUUFBaEI7O0FBQ0EsYUFBTztBQUNMRSxRQUFBQSxNQUFNLEVBQUUsa0JBQU07QUFDWk4sVUFBQUEsVUFBVSxHQUFHQSxVQUFVLENBQUNPLE1BQVgsQ0FBa0IsVUFBQUMsUUFBUTtBQUFBLG1CQUFJSixRQUFRLEtBQUtJLFFBQWpCO0FBQUEsV0FBMUIsQ0FBYjtBQUNEO0FBSEksT0FBUDtBQUtEOzs7a0NBRW9C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O0FBQ0Q7Ozs4QkFFa0I7QUFDakIsYUFBTyxLQUFLOUMsUUFBWjtBQUNEOzs7aUNBRVk7QUFDWCxXQUFLRCxrQkFBTCxHQUEwQixJQUExQjtBQUNBLFdBQUtFLEtBQUwsR0FBYSxJQUFJMUIsSUFBSixFQUFiO0FBQ0EsV0FBSzJCLHFCQUFMLEdBQTZCLElBQTdCO0FBQ0EsV0FBS0MsaUJBQUwsR0FBeUIsSUFBekI7QUFDRDs7Ozs7QUFHSDZDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNELGNBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgcGVyZm9ybWFuY2VOb3cgPSByZXF1aXJlKCdmYmpzL2xpYi9wZXJmb3JtYW5jZU5vdycpO1xuY29uc3Qgd2FybmluZyA9IHJlcXVpcmUoJ2ZianMvbGliL3dhcm5pbmcnKTtcblxuZXhwb3J0IHR5cGUgRmlsbFJhdGVJbmZvID0gSW5mbztcblxuY2xhc3MgSW5mbyB7XG4gIGFueV9ibGFua19jb3VudDogbnVtYmVyID0gMDtcbiAgYW55X2JsYW5rX21zOiBudW1iZXIgPSAwO1xuICBhbnlfYmxhbmtfc3BlZWRfc3VtOiBudW1iZXIgPSAwO1xuICBtb3N0bHlfYmxhbmtfY291bnQ6IG51bWJlciA9IDA7XG4gIG1vc3RseV9ibGFua19tczogbnVtYmVyID0gMDtcbiAgcGl4ZWxzX2JsYW5rOiBudW1iZXIgPSAwO1xuICBwaXhlbHNfc2FtcGxlZDogbnVtYmVyID0gMDtcbiAgcGl4ZWxzX3Njcm9sbGVkOiBudW1iZXIgPSAwO1xuICB0b3RhbF90aW1lX3NwZW50OiBudW1iZXIgPSAwO1xuICBzYW1wbGVfY291bnQ6IG51bWJlciA9IDA7XG59XG5cbnR5cGUgRnJhbWVNZXRyaWNzID0ge2luTGF5b3V0PzogYm9vbGVhbiwgbGVuZ3RoOiBudW1iZXIsIG9mZnNldDogbnVtYmVyfTtcblxuY29uc3QgREVCVUcgPSBmYWxzZTtcblxubGV0IF9saXN0ZW5lcnM6IEFycmF5PChJbmZvKSA9PiB2b2lkPiA9IFtdO1xubGV0IF9taW5TYW1wbGVDb3VudCA9IDEwO1xubGV0IF9zYW1wbGVSYXRlID0gREVCVUcgPyAxIDogbnVsbDtcblxuLyoqXG4gKiBBIGhlbHBlciBjbGFzcyBmb3IgZGV0ZWN0aW5nIHdoZW4gdGhlIG1heGltZW0gZmlsbCByYXRlIG9mIGBWaXJ0dWFsaXplZExpc3RgIGlzIGV4Y2VlZGVkLlxuICogQnkgZGVmYXVsdCB0aGUgc2FtcGxpbmcgcmF0ZSBpcyBzZXQgdG8gemVybyBhbmQgdGhpcyB3aWxsIGRvIG5vdGhpbmcuIElmIHlvdSB3YW50IHRvIGNvbGxlY3RcbiAqIHNhbXBsZXMgKGUuZy4gdG8gbG9nIHRoZW0pLCBtYWtlIHN1cmUgdG8gY2FsbCBgRmlsbFJhdGVIZWxwZXIuc2V0U2FtcGxlUmF0ZSgwLjAtMS4wKWAuXG4gKlxuICogTGlzdGVuZXJzIGFuZCBzYW1wbGUgcmF0ZSBhcmUgZ2xvYmFsIGZvciBhbGwgYFZpcnR1YWxpemVkTGlzdGBzIC0gdHlwaWNhbCB1c2FnZSB3aWxsIGNvbWJpbmUgd2l0aFxuICogYFNjZW5lVHJhY2tlci5nZXRBY3RpdmVTY2VuZWAgdG8gZGV0ZXJtaW5lIHRoZSBjb250ZXh0IG9mIHRoZSBldmVudHMuXG4gKi9cbmNsYXNzIEZpbGxSYXRlSGVscGVyIHtcbiAgX2FueUJsYW5rU3RhcnRUaW1lID0gKG51bGw6ID9udW1iZXIpO1xuICBfZW5hYmxlZCA9IGZhbHNlO1xuICBfZ2V0RnJhbWVNZXRyaWNzOiAoaW5kZXg6IG51bWJlcikgPT4gP0ZyYW1lTWV0cmljcztcbiAgX2luZm8gPSBuZXcgSW5mbygpO1xuICBfbW9zdGx5QmxhbmtTdGFydFRpbWUgPSAobnVsbDogP251bWJlcik7XG4gIF9zYW1wbGVzU3RhcnRUaW1lID0gKG51bGw6ID9udW1iZXIpO1xuXG4gIHN0YXRpYyBhZGRMaXN0ZW5lcihjYWxsYmFjazogRmlsbFJhdGVJbmZvID0+IHZvaWQpOiB7cmVtb3ZlOiAoKSA9PiB2b2lkfSB7XG4gICAgd2FybmluZyhcbiAgICAgIF9zYW1wbGVSYXRlICE9PSBudWxsLFxuICAgICAgJ0NhbGwgYEZpbGxSYXRlSGVscGVyLnNldFNhbXBsZVJhdGVgIGJlZm9yZSBgYWRkTGlzdGVuZXJgLicsXG4gICAgKTtcbiAgICBfbGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICAgIHJldHVybiB7XG4gICAgICByZW1vdmU6ICgpID0+IHtcbiAgICAgICAgX2xpc3RlbmVycyA9IF9saXN0ZW5lcnMuZmlsdGVyKGxpc3RlbmVyID0+IGNhbGxiYWNrICE9PSBsaXN0ZW5lcik7XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgc2V0U2FtcGxlUmF0ZShzYW1wbGVSYXRlOiBudW1iZXIpIHtcbiAgICBfc2FtcGxlUmF0ZSA9IHNhbXBsZVJhdGU7XG4gIH1cblxuICBzdGF0aWMgc2V0TWluU2FtcGxlQ291bnQobWluU2FtcGxlQ291bnQ6IG51bWJlcikge1xuICAgIF9taW5TYW1wbGVDb3VudCA9IG1pblNhbXBsZUNvdW50O1xuICB9XG5cbiAgY29uc3RydWN0b3IoZ2V0RnJhbWVNZXRyaWNzOiAoaW5kZXg6IG51bWJlcikgPT4gP0ZyYW1lTWV0cmljcykge1xuICAgIHRoaXMuX2dldEZyYW1lTWV0cmljcyA9IGdldEZyYW1lTWV0cmljcztcbiAgICB0aGlzLl9lbmFibGVkID0gKF9zYW1wbGVSYXRlIHx8IDApID4gTWF0aC5yYW5kb20oKTtcbiAgICB0aGlzLl9yZXNldERhdGEoKTtcbiAgfVxuXG4gIGFjdGl2YXRlKCkge1xuICAgIGlmICh0aGlzLl9lbmFibGVkICYmIHRoaXMuX3NhbXBsZXNTdGFydFRpbWUgPT0gbnVsbCkge1xuICAgICAgREVCVUcgJiYgY29uc29sZS5kZWJ1ZygnRmlsbFJhdGVIZWxwZXI6IGFjdGl2YXRlJyk7XG4gICAgICB0aGlzLl9zYW1wbGVzU3RhcnRUaW1lID0gcGVyZm9ybWFuY2VOb3coKTtcbiAgICB9XG4gIH1cblxuICBkZWFjdGl2YXRlQW5kRmx1c2goKSB7XG4gICAgaWYgKCF0aGlzLl9lbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5fc2FtcGxlc1N0YXJ0VGltZTsgLy8gY29uc3QgZm9yIGZsb3dcbiAgICBpZiAoc3RhcnQgPT0gbnVsbCkge1xuICAgICAgREVCVUcgJiZcbiAgICAgICAgY29uc29sZS5kZWJ1ZygnRmlsbFJhdGVIZWxwZXI6IGJhaWwgb24gZGVhY3RpdmF0ZSB3aXRoIG5vIHN0YXJ0IHRpbWUnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuX2luZm8uc2FtcGxlX2NvdW50IDwgX21pblNhbXBsZUNvdW50KSB7XG4gICAgICAvLyBEb24ndCBib3RoZXIgd2l0aCB1bmRlci1zYW1wbGVkIGV2ZW50cy5cbiAgICAgIHRoaXMuX3Jlc2V0RGF0YSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0b3RhbF90aW1lX3NwZW50ID0gcGVyZm9ybWFuY2VOb3coKSAtIHN0YXJ0O1xuICAgIGNvbnN0IGluZm86IGFueSA9IHtcbiAgICAgIC4uLnRoaXMuX2luZm8sXG4gICAgICB0b3RhbF90aW1lX3NwZW50LFxuICAgIH07XG4gICAgaWYgKERFQlVHKSB7XG4gICAgICBjb25zdCBkZXJpdmVkID0ge1xuICAgICAgICBhdmdfYmxhbmtuZXNzOiB0aGlzLl9pbmZvLnBpeGVsc19ibGFuayAvIHRoaXMuX2luZm8ucGl4ZWxzX3NhbXBsZWQsXG4gICAgICAgIGF2Z19zcGVlZDogdGhpcy5faW5mby5waXhlbHNfc2Nyb2xsZWQgLyAodG90YWxfdGltZV9zcGVudCAvIDEwMDApLFxuICAgICAgICBhdmdfc3BlZWRfd2hlbl9hbnlfYmxhbms6XG4gICAgICAgICAgdGhpcy5faW5mby5hbnlfYmxhbmtfc3BlZWRfc3VtIC8gdGhpcy5faW5mby5hbnlfYmxhbmtfY291bnQsXG4gICAgICAgIGFueV9ibGFua19wZXJfbWluOlxuICAgICAgICAgIHRoaXMuX2luZm8uYW55X2JsYW5rX2NvdW50IC8gKHRvdGFsX3RpbWVfc3BlbnQgLyAxMDAwIC8gNjApLFxuICAgICAgICBhbnlfYmxhbmtfdGltZV9mcmFjOiB0aGlzLl9pbmZvLmFueV9ibGFua19tcyAvIHRvdGFsX3RpbWVfc3BlbnQsXG4gICAgICAgIG1vc3RseV9ibGFua19wZXJfbWluOlxuICAgICAgICAgIHRoaXMuX2luZm8ubW9zdGx5X2JsYW5rX2NvdW50IC8gKHRvdGFsX3RpbWVfc3BlbnQgLyAxMDAwIC8gNjApLFxuICAgICAgICBtb3N0bHlfYmxhbmtfdGltZV9mcmFjOiB0aGlzLl9pbmZvLm1vc3RseV9ibGFua19tcyAvIHRvdGFsX3RpbWVfc3BlbnQsXG4gICAgICB9O1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGVyaXZlZCkge1xuICAgICAgICBkZXJpdmVkW2tleV0gPSBNYXRoLnJvdW5kKDEwMDAgKiBkZXJpdmVkW2tleV0pIC8gMTAwMDtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUuZGVidWcoJ0ZpbGxSYXRlSGVscGVyIGRlYWN0aXZhdGVBbmRGbHVzaDogJywge2Rlcml2ZWQsIGluZm99KTtcbiAgICB9XG4gICAgX2xpc3RlbmVycy5mb3JFYWNoKGxpc3RlbmVyID0+IGxpc3RlbmVyKGluZm8pKTtcbiAgICB0aGlzLl9yZXNldERhdGEoKTtcbiAgfVxuXG4gIGNvbXB1dGVCbGFua25lc3MoXG4gICAgcHJvcHM6IHtcbiAgICAgIGRhdGE6IEFycmF5PGFueT4sXG4gICAgICBnZXRJdGVtQ291bnQ6IChkYXRhOiBBcnJheTxhbnk+KSA9PiBudW1iZXIsXG4gICAgICBpbml0aWFsTnVtVG9SZW5kZXI6IG51bWJlcixcbiAgICB9LFxuICAgIHN0YXRlOiB7XG4gICAgICBmaXJzdDogbnVtYmVyLFxuICAgICAgbGFzdDogbnVtYmVyLFxuICAgIH0sXG4gICAgc2Nyb2xsTWV0cmljczoge1xuICAgICAgZE9mZnNldDogbnVtYmVyLFxuICAgICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgICB2ZWxvY2l0eTogbnVtYmVyLFxuICAgICAgdmlzaWJsZUxlbmd0aDogbnVtYmVyLFxuICAgIH0sXG4gICk6IG51bWJlciB7XG4gICAgaWYgKFxuICAgICAgIXRoaXMuX2VuYWJsZWQgfHxcbiAgICAgIHByb3BzLmdldEl0ZW1Db3VudChwcm9wcy5kYXRhKSA9PT0gMCB8fFxuICAgICAgdGhpcy5fc2FtcGxlc1N0YXJ0VGltZSA9PSBudWxsXG4gICAgKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3Qge2RPZmZzZXQsIG9mZnNldCwgdmVsb2NpdHksIHZpc2libGVMZW5ndGh9ID0gc2Nyb2xsTWV0cmljcztcblxuICAgIC8vIERlbm9taW5hdG9yIG1ldHJpY3MgdGhhdCB3ZSB0cmFjayBmb3IgYWxsIGV2ZW50cyAtIG1vc3Qgb2YgdGhlIHRpbWUgdGhlcmUgaXMgbm8gYmxhbmtuZXNzIGFuZFxuICAgIC8vIHdlIHdhbnQgdG8gY2FwdHVyZSB0aGF0LlxuICAgIHRoaXMuX2luZm8uc2FtcGxlX2NvdW50Kys7XG4gICAgdGhpcy5faW5mby5waXhlbHNfc2FtcGxlZCArPSBNYXRoLnJvdW5kKHZpc2libGVMZW5ndGgpO1xuICAgIHRoaXMuX2luZm8ucGl4ZWxzX3Njcm9sbGVkICs9IE1hdGgucm91bmQoTWF0aC5hYnMoZE9mZnNldCkpO1xuICAgIGNvbnN0IHNjcm9sbFNwZWVkID0gTWF0aC5yb3VuZChNYXRoLmFicyh2ZWxvY2l0eSkgKiAxMDAwKTsgLy8gcHggLyBzZWNcblxuICAgIC8vIFdoZXRoZXIgYmxhbmsgbm93IG9yIG5vdCwgcmVjb3JkIHRoZSBlbGFwc2VkIHRpbWUgYmxhbmsgaWYgd2Ugd2VyZSBibGFuayBsYXN0IHRpbWUuXG4gICAgY29uc3Qgbm93ID0gcGVyZm9ybWFuY2VOb3coKTtcbiAgICBpZiAodGhpcy5fYW55QmxhbmtTdGFydFRpbWUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5faW5mby5hbnlfYmxhbmtfbXMgKz0gbm93IC0gdGhpcy5fYW55QmxhbmtTdGFydFRpbWU7XG4gICAgfVxuICAgIHRoaXMuX2FueUJsYW5rU3RhcnRUaW1lID0gbnVsbDtcbiAgICBpZiAodGhpcy5fbW9zdGx5QmxhbmtTdGFydFRpbWUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5faW5mby5tb3N0bHlfYmxhbmtfbXMgKz0gbm93IC0gdGhpcy5fbW9zdGx5QmxhbmtTdGFydFRpbWU7XG4gICAgfVxuICAgIHRoaXMuX21vc3RseUJsYW5rU3RhcnRUaW1lID0gbnVsbDtcblxuICAgIGxldCBibGFua1RvcCA9IDA7XG4gICAgbGV0IGZpcnN0ID0gc3RhdGUuZmlyc3Q7XG4gICAgbGV0IGZpcnN0RnJhbWUgPSB0aGlzLl9nZXRGcmFtZU1ldHJpY3MoZmlyc3QpO1xuICAgIHdoaWxlIChmaXJzdCA8PSBzdGF0ZS5sYXN0ICYmICghZmlyc3RGcmFtZSB8fCAhZmlyc3RGcmFtZS5pbkxheW91dCkpIHtcbiAgICAgIGZpcnN0RnJhbWUgPSB0aGlzLl9nZXRGcmFtZU1ldHJpY3MoZmlyc3QpO1xuICAgICAgZmlyc3QrKztcbiAgICB9XG4gICAgLy8gT25seSBjb3VudCBibGFua1RvcCBpZiB3ZSBhcmVuJ3QgcmVuZGVyaW5nIHRoZSBmaXJzdCBpdGVtLCBvdGhlcndpc2Ugd2Ugd2lsbCBjb3VudCB0aGUgaGVhZGVyXG4gICAgLy8gYXMgYmxhbmsuXG4gICAgaWYgKGZpcnN0RnJhbWUgJiYgZmlyc3QgPiAwKSB7XG4gICAgICBibGFua1RvcCA9IE1hdGgubWluKFxuICAgICAgICB2aXNpYmxlTGVuZ3RoLFxuICAgICAgICBNYXRoLm1heCgwLCBmaXJzdEZyYW1lLm9mZnNldCAtIG9mZnNldCksXG4gICAgICApO1xuICAgIH1cbiAgICBsZXQgYmxhbmtCb3R0b20gPSAwO1xuICAgIGxldCBsYXN0ID0gc3RhdGUubGFzdDtcbiAgICBsZXQgbGFzdEZyYW1lID0gdGhpcy5fZ2V0RnJhbWVNZXRyaWNzKGxhc3QpO1xuICAgIHdoaWxlIChsYXN0ID49IHN0YXRlLmZpcnN0ICYmICghbGFzdEZyYW1lIHx8ICFsYXN0RnJhbWUuaW5MYXlvdXQpKSB7XG4gICAgICBsYXN0RnJhbWUgPSB0aGlzLl9nZXRGcmFtZU1ldHJpY3MobGFzdCk7XG4gICAgICBsYXN0LS07XG4gICAgfVxuICAgIC8vIE9ubHkgY291bnQgYmxhbmtCb3R0b20gaWYgd2UgYXJlbid0IHJlbmRlcmluZyB0aGUgbGFzdCBpdGVtLCBvdGhlcndpc2Ugd2Ugd2lsbCBjb3VudCB0aGVcbiAgICAvLyBmb290ZXIgYXMgYmxhbmsuXG4gICAgaWYgKGxhc3RGcmFtZSAmJiBsYXN0IDwgcHJvcHMuZ2V0SXRlbUNvdW50KHByb3BzLmRhdGEpIC0gMSkge1xuICAgICAgY29uc3QgYm90dG9tRWRnZSA9IGxhc3RGcmFtZS5vZmZzZXQgKyBsYXN0RnJhbWUubGVuZ3RoO1xuICAgICAgYmxhbmtCb3R0b20gPSBNYXRoLm1pbihcbiAgICAgICAgdmlzaWJsZUxlbmd0aCxcbiAgICAgICAgTWF0aC5tYXgoMCwgb2Zmc2V0ICsgdmlzaWJsZUxlbmd0aCAtIGJvdHRvbUVkZ2UpLFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgcGl4ZWxzX2JsYW5rID0gTWF0aC5yb3VuZChibGFua1RvcCArIGJsYW5rQm90dG9tKTtcbiAgICBjb25zdCBibGFua25lc3MgPSBwaXhlbHNfYmxhbmsgLyB2aXNpYmxlTGVuZ3RoO1xuICAgIGlmIChibGFua25lc3MgPiAwKSB7XG4gICAgICB0aGlzLl9hbnlCbGFua1N0YXJ0VGltZSA9IG5vdztcbiAgICAgIHRoaXMuX2luZm8uYW55X2JsYW5rX3NwZWVkX3N1bSArPSBzY3JvbGxTcGVlZDtcbiAgICAgIHRoaXMuX2luZm8uYW55X2JsYW5rX2NvdW50Kys7XG4gICAgICB0aGlzLl9pbmZvLnBpeGVsc19ibGFuayArPSBwaXhlbHNfYmxhbms7XG4gICAgICBpZiAoYmxhbmtuZXNzID4gMC41KSB7XG4gICAgICAgIHRoaXMuX21vc3RseUJsYW5rU3RhcnRUaW1lID0gbm93O1xuICAgICAgICB0aGlzLl9pbmZvLm1vc3RseV9ibGFua19jb3VudCsrO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc2Nyb2xsU3BlZWQgPCAwLjAxIHx8IE1hdGguYWJzKGRPZmZzZXQpIDwgMSkge1xuICAgICAgdGhpcy5kZWFjdGl2YXRlQW5kRmx1c2goKTtcbiAgICB9XG4gICAgcmV0dXJuIGJsYW5rbmVzcztcbiAgfVxuXG4gIGVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQ7XG4gIH1cblxuICBfcmVzZXREYXRhKCkge1xuICAgIHRoaXMuX2FueUJsYW5rU3RhcnRUaW1lID0gbnVsbDtcbiAgICB0aGlzLl9pbmZvID0gbmV3IEluZm8oKTtcbiAgICB0aGlzLl9tb3N0bHlCbGFua1N0YXJ0VGltZSA9IG51bGw7XG4gICAgdGhpcy5fc2FtcGxlc1N0YXJ0VGltZSA9IG51bGw7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBGaWxsUmF0ZUhlbHBlcjtcbiJdfQ==