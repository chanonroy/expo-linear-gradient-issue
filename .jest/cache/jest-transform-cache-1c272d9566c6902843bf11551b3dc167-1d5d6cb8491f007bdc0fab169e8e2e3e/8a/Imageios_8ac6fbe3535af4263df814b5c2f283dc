1355527273e29b530077c4d1252869fe
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var DeprecatedImagePropType = require("../DeprecatedPropTypes/DeprecatedImagePropType");

var NativeModules = require("../BatchedBridge/NativeModules");

var React = require('react');

var ReactNative = require("../Renderer/shims/ReactNative");

var StyleSheet = require("../StyleSheet/StyleSheet");

var flattenStyle = require("../StyleSheet/flattenStyle");

var requireNativeComponent = require("../ReactNative/requireNativeComponent");

var resolveAssetSource = require("./resolveAssetSource");

var ImageViewManager = NativeModules.ImageViewManager;
var RCTImageView = requireNativeComponent('RCTImageView');

function getSize(uri, success, failure) {
  ImageViewManager.getSize(uri, success, failure || function () {
    console.warn('Failed to get size for image: ' + uri);
  });
}

function getSizeWithHeaders(uri, headers, success, failure) {
  return ImageViewManager.getSizeWithHeaders({
    uri: uri,
    headers: headers
  }).then(function (sizes) {
    success(sizes.width, sizes.height);
  }).catch(failure || function () {
    console.warn('Failed to get size for image: ' + uri);
  });
}

function prefetch(url) {
  return ImageViewManager.prefetchImage(url);
}

function queryCache(urls) {
  return _regenerator.default.async(function queryCache$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return _regenerator.default.awrap(ImageViewManager.queryCache(urls));

        case 2:
          return _context.abrupt("return", _context.sent);

        case 3:
        case "end":
          return _context.stop();
      }
    }
  }, null, null, null, Promise);
}

var Image = function Image(props, forwardedRef) {
  var source = resolveAssetSource(props.source) || {
    uri: undefined,
    width: undefined,
    height: undefined
  };
  var sources;
  var style;

  if (Array.isArray(source)) {
    style = flattenStyle([styles.base, props.style]) || {};
    sources = source;
  } else {
    var _width = source.width,
        _height = source.height,
        uri = source.uri;
    style = flattenStyle([{
      width: _width,
      height: _height
    }, styles.base, props.style]) || {};
    sources = [source];

    if (uri === '') {
      console.warn('source.uri should not be an empty string');
    }
  }

  var resizeMode = props.resizeMode || style.resizeMode || 'cover';
  var tintColor = style.tintColor;

  if (props.src != null) {
    console.warn('The <Image> component requires a `source` property rather than `src`.');
  }

  if (props.children != null) {
    throw new Error('The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.');
  }

  return React.createElement(RCTImageView, (0, _extends2.default)({}, props, {
    ref: forwardedRef,
    style: style,
    resizeMode: resizeMode,
    tintColor: tintColor,
    source: sources
  }));
};

Image = React.forwardRef(Image);
Image.displayName = 'Image';
Image.getSize = getSize;
Image.getSizeWithHeaders = getSizeWithHeaders;
Image.prefetch = prefetch;
Image.queryCache = queryCache;
Image.resolveAssetSource = resolveAssetSource;
Image.propTypes = DeprecatedImagePropType;
var styles = StyleSheet.create({
  base: {
    overflow: 'hidden'
  }
});
module.exports = Image;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltYWdlLmlvcy5qcyJdLCJuYW1lcyI6WyJEZXByZWNhdGVkSW1hZ2VQcm9wVHlwZSIsInJlcXVpcmUiLCJOYXRpdmVNb2R1bGVzIiwiUmVhY3QiLCJSZWFjdE5hdGl2ZSIsIlN0eWxlU2hlZXQiLCJmbGF0dGVuU3R5bGUiLCJyZXF1aXJlTmF0aXZlQ29tcG9uZW50IiwicmVzb2x2ZUFzc2V0U291cmNlIiwiSW1hZ2VWaWV3TWFuYWdlciIsIlJDVEltYWdlVmlldyIsImdldFNpemUiLCJ1cmkiLCJzdWNjZXNzIiwiZmFpbHVyZSIsImNvbnNvbGUiLCJ3YXJuIiwiZ2V0U2l6ZVdpdGhIZWFkZXJzIiwiaGVhZGVycyIsInRoZW4iLCJzaXplcyIsIndpZHRoIiwiaGVpZ2h0IiwiY2F0Y2giLCJwcmVmZXRjaCIsInVybCIsInByZWZldGNoSW1hZ2UiLCJxdWVyeUNhY2hlIiwidXJscyIsIkltYWdlIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJzb3VyY2UiLCJ1bmRlZmluZWQiLCJzb3VyY2VzIiwic3R5bGUiLCJBcnJheSIsImlzQXJyYXkiLCJzdHlsZXMiLCJiYXNlIiwicmVzaXplTW9kZSIsInRpbnRDb2xvciIsInNyYyIsImNoaWxkcmVuIiwiRXJyb3IiLCJmb3J3YXJkUmVmIiwiZGlzcGxheU5hbWUiLCJwcm9wVHlwZXMiLCJjcmVhdGUiLCJvdmVyZmxvdyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVNBOzs7Ozs7OztBQUVBLElBQU1BLHVCQUF1QixHQUFHQyxPQUFPLGtEQUF2Qzs7QUFDQSxJQUFNQyxhQUFhLEdBQUdELE9BQU8sa0NBQTdCOztBQUNBLElBQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsSUFBTUcsV0FBVyxHQUFHSCxPQUFPLGlDQUEzQjs7QUFDQSxJQUFNSSxVQUFVLEdBQUdKLE9BQU8sNEJBQTFCOztBQUVBLElBQU1LLFlBQVksR0FBR0wsT0FBTyw4QkFBNUI7O0FBQ0EsSUFBTU0sc0JB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TjtBQUR5QixDQUFsQixDQUFmO0FBU0FDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFrQnRCLEtBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IERlcHJlY2F0ZWRJbWFnZVByb3BUeXBlID0gcmVxdWlyZSgnLi4vRGVwcmVjYXRlZFByb3BUeXBlcy9EZXByZWNhdGVkSW1hZ2VQcm9wVHlwZScpO1xuY29uc3QgTmF0aXZlTW9kdWxlcyA9IHJlcXVpcmUoJy4uL0JhdGNoZWRCcmlkZ2UvTmF0aXZlTW9kdWxlcycpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgUmVhY3ROYXRpdmUgPSByZXF1aXJlKCcuLi9SZW5kZXJlci9zaGltcy9SZWFjdE5hdGl2ZScpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG5jb25zdCBTdHlsZVNoZWV0ID0gcmVxdWlyZSgnLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0Jyk7XG5cbmNvbnN0IGZsYXR0ZW5TdHlsZSA9IHJlcXVpcmUoJy4uL1N0eWxlU2hlZXQvZmxhdHRlblN0eWxlJyk7XG5jb25zdCByZXF1aXJlTmF0aXZlQ29tcG9uZW50ID0gcmVxdWlyZSgnLi4vUmVhY3ROYXRpdmUvcmVxdWlyZU5hdGl2ZUNvbXBvbmVudCcpO1xuY29uc3QgcmVzb2x2ZUFzc2V0U291cmNlID0gcmVxdWlyZSgnLi9yZXNvbHZlQXNzZXRTb3VyY2UnKTtcblxuY29uc3QgSW1hZ2VWaWV3TWFuYWdlciA9IE5hdGl2ZU1vZHVsZXMuSW1hZ2VWaWV3TWFuYWdlcjtcblxuY29uc3QgUkNUSW1hZ2VWaWV3ID0gcmVxdWlyZU5hdGl2ZUNvbXBvbmVudCgnUkNUSW1hZ2VWaWV3Jyk7XG5cbmltcG9ydCB0eXBlIHtJbWFnZVByb3BzIGFzIEltYWdlUHJvcHNUeXBlfSBmcm9tICcuL0ltYWdlUHJvcHMnO1xuXG5pbXBvcnQgdHlwZSB7SW1hZ2VTdHlsZVByb3B9IGZyb20gJy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCc7XG5cbmZ1bmN0aW9uIGdldFNpemUoXG4gIHVyaTogc3RyaW5nLFxuICBzdWNjZXNzOiAod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpID0+IHZvaWQsXG4gIGZhaWx1cmU/OiAoZXJyb3I6IGFueSkgPT4gdm9pZCxcbikge1xuICBJbWFnZVZpZXdNYW5hZ2VyLmdldFNpemUoXG4gICAgdXJpLFxuICAgIHN1Y2Nlc3MsXG4gICAgZmFpbHVyZSB8fFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGdldCBzaXplIGZvciBpbWFnZTogJyArIHVyaSk7XG4gICAgICB9LFxuICApO1xufVxuXG5mdW5jdGlvbiBnZXRTaXplV2l0aEhlYWRlcnMoXG4gIHVyaTogc3RyaW5nLFxuICBoZWFkZXJzOiB7W3N0cmluZ106IHN0cmluZ30sXG4gIHN1Y2Nlc3M6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gdm9pZCxcbiAgZmFpbHVyZT86IChlcnJvcjogYW55KSA9PiB2b2lkLFxuKTogYW55IHtcbiAgcmV0dXJuIEltYWdlVmlld01hbmFnZXIuZ2V0U2l6ZVdpdGhIZWFkZXJzKHt1cmksIGhlYWRlcnN9KVxuICAgIC50aGVuKGZ1bmN0aW9uKHNpemVzKSB7XG4gICAgICBzdWNjZXNzKHNpemVzLndpZHRoLCBzaXplcy5oZWlnaHQpO1xuICAgIH0pXG4gICAgLmNhdGNoKFxuICAgICAgZmFpbHVyZSB8fFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBnZXQgc2l6ZSBmb3IgaW1hZ2U6ICcgKyB1cmkpO1xuICAgICAgICB9LFxuICAgICk7XG59XG5cbmZ1bmN0aW9uIHByZWZldGNoKHVybDogc3RyaW5nKTogYW55IHtcbiAgcmV0dXJuIEltYWdlVmlld01hbmFnZXIucHJlZmV0Y2hJbWFnZSh1cmwpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBxdWVyeUNhY2hlKFxuICB1cmxzOiBBcnJheTxzdHJpbmc+LFxuKTogUHJvbWlzZTx7W3N0cmluZ106ICdtZW1vcnknIHwgJ2Rpc2snIHwgJ2Rpc2svbWVtb3J5J30+IHtcbiAgcmV0dXJuIGF3YWl0IEltYWdlVmlld01hbmFnZXIucXVlcnlDYWNoZSh1cmxzKTtcbn1cblxuZGVjbGFyZSBjbGFzcyBJbWFnZUNvbXBvbmVudFR5cGUgZXh0ZW5kcyBSZWFjdE5hdGl2ZS5OYXRpdmVDb21wb25lbnQ8SW1hZ2VQcm9wc1R5cGU+IHtcbiAgc3RhdGljIGdldFNpemU6IHR5cGVvZiBnZXRTaXplO1xuICBzdGF0aWMgZ2V0U2l6ZVdpdGhIZWFkZXJzOiB0eXBlb2YgZ2V0U2l6ZVdpdGhIZWFkZXJzO1xuICBzdGF0aWMgcHJlZmV0Y2g6IHR5cGVvZiBwcmVmZXRjaDtcbiAgc3RhdGljIHF1ZXJ5Q2FjaGU6IHR5cGVvZiBxdWVyeUNhY2hlO1xuICBzdGF0aWMgcmVzb2x2ZUFzc2V0U291cmNlOiB0eXBlb2YgcmVzb2x2ZUFzc2V0U291cmNlO1xuICBzdGF0aWMgcHJvcFR5cGVzOiB0eXBlb2YgRGVwcmVjYXRlZEltYWdlUHJvcFR5cGU7XG59XG5cbi8qKlxuICogQSBSZWFjdCBjb21wb25lbnQgZm9yIGRpc3BsYXlpbmcgZGlmZmVyZW50IHR5cGVzIG9mIGltYWdlcyxcbiAqIGluY2x1ZGluZyBuZXR3b3JrIGltYWdlcywgc3RhdGljIHJlc291cmNlcywgdGVtcG9yYXJ5IGxvY2FsIGltYWdlcywgYW5kXG4gKiBpbWFnZXMgZnJvbSBsb2NhbCBkaXNrLCBzdWNoIGFzIHRoZSBjYW1lcmEgcm9sbC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvaW1hZ2UuaHRtbFxuICovXG5sZXQgSW1hZ2UgPSAoXG4gIHByb3BzOiBJbWFnZVByb3BzVHlwZSxcbiAgZm9yd2FyZGVkUmVmOiA/UmVhY3QuUmVmPCdSQ1RJbWFnZVZpZXcnPixcbikgPT4ge1xuICBjb25zdCBzb3VyY2UgPSByZXNvbHZlQXNzZXRTb3VyY2UocHJvcHMuc291cmNlKSB8fCB7XG4gICAgdXJpOiB1bmRlZmluZWQsXG4gICAgd2lkdGg6IHVuZGVmaW5lZCxcbiAgICBoZWlnaHQ6IHVuZGVmaW5lZCxcbiAgfTtcblxuICBsZXQgc291cmNlcztcbiAgbGV0IHN0eWxlOiBJbWFnZVN0eWxlUHJvcDtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkge1xuICAgIC8vICRGbG93Rml4TWUgZmxhdHRlblN0eWxlIGlzIG5vdCBzdHJvbmcgZW5vdWdoXG4gICAgc3R5bGUgPSBmbGF0dGVuU3R5bGUoW3N0eWxlcy5iYXNlLCBwcm9wcy5zdHlsZV0pIHx8IHt9O1xuICAgIHNvdXJjZXMgPSBzb3VyY2U7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qge3dpZHRoLCBoZWlnaHQsIHVyaX0gPSBzb3VyY2U7XG4gICAgLy8gJEZsb3dGaXhNZSBmbGF0dGVuU3R5bGUgaXMgbm90IHN0cm9uZyBlbm91Z2hcbiAgICBzdHlsZSA9IGZsYXR0ZW5TdHlsZShbe3dpZHRoLCBoZWlnaHR9LCBzdHlsZXMuYmFzZSwgcHJvcHMuc3R5bGVdKSB8fCB7fTtcbiAgICBzb3VyY2VzID0gW3NvdXJjZV07XG5cbiAgICBpZiAodXJpID09PSAnJykge1xuICAgICAgY29uc29sZS53YXJuKCdzb3VyY2UudXJpIHNob3VsZCBub3QgYmUgYW4gZW1wdHkgc3RyaW5nJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVzaXplTW9kZSA9IHByb3BzLnJlc2l6ZU1vZGUgfHwgc3R5bGUucmVzaXplTW9kZSB8fCAnY292ZXInO1xuICBjb25zdCB0aW50Q29sb3IgPSBzdHlsZS50aW50Q29sb3I7XG5cbiAgaWYgKHByb3BzLnNyYyAhPSBudWxsKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ1RoZSA8SW1hZ2U+IGNvbXBvbmVudCByZXF1aXJlcyBhIGBzb3VyY2VgIHByb3BlcnR5IHJhdGhlciB0aGFuIGBzcmNgLicsXG4gICAgKTtcbiAgfVxuXG4gIGlmIChwcm9wcy5jaGlsZHJlbiAhPSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1RoZSA8SW1hZ2U+IGNvbXBvbmVudCBjYW5ub3QgY29udGFpbiBjaGlsZHJlbi4gSWYgeW91IHdhbnQgdG8gcmVuZGVyIGNvbnRlbnQgb24gdG9wIG9mIHRoZSBpbWFnZSwgY29uc2lkZXIgdXNpbmcgdGhlIDxJbWFnZUJhY2tncm91bmQ+IGNvbXBvbmVudCBvciBhYnNvbHV0ZSBwb3NpdGlvbmluZy4nLFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxSQ1RJbWFnZVZpZXdcbiAgICAgIHsuLi5wcm9wc31cbiAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgcmVzaXplTW9kZT17cmVzaXplTW9kZX1cbiAgICAgIHRpbnRDb2xvcj17dGludENvbG9yfVxuICAgICAgc291cmNlPXtzb3VyY2VzfVxuICAgIC8+XG4gICk7XG59O1xuXG5JbWFnZSA9IFJlYWN0LmZvcndhcmRSZWYoSW1hZ2UpO1xuSW1hZ2UuZGlzcGxheU5hbWUgPSAnSW1hZ2UnO1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IChpbiBwaXhlbHMpIG9mIGFuIGltYWdlIHByaW9yIHRvIGRpc3BsYXlpbmcgaXQuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjZ2V0c2l6ZVxuICovXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLmdldFNpemUgPSBnZXRTaXplO1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IChpbiBwaXhlbHMpIG9mIGFuIGltYWdlIHByaW9yIHRvIGRpc3BsYXlpbmcgaXRcbiAqIHdpdGggdGhlIGFiaWxpdHkgdG8gcHJvdmlkZSB0aGUgaGVhZGVycyBmb3IgdGhlIHJlcXVlc3QuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjZ2V0c2l6ZXdpdGhoZWFkZXJzXG4gKi9cbi8qICRGbG93Rml4TWUoPj0wLjg5LjAgc2l0ZT1yZWFjdF9uYXRpdmVfaW9zX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXNcbiAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuSW1hZ2UuZ2V0U2l6ZVdpdGhIZWFkZXJzID0gZ2V0U2l6ZVdpdGhIZWFkZXJzO1xuXG4vKipcbiAqIFByZWZldGNoZXMgYSByZW1vdGUgaW1hZ2UgZm9yIGxhdGVyIHVzZSBieSBkb3dubG9hZGluZyBpdCB0byB0aGUgZGlza1xuICogY2FjaGUuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjcHJlZmV0Y2hcbiAqL1xuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5wcmVmZXRjaCA9IHByZWZldGNoO1xuXG4vKipcbiAqIFBlcmZvcm1zIGNhY2hlIGludGVycm9nYXRpb24uXG4gKlxuICogIFNlZSBodHRwczovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9pbWFnZS5odG1sI3F1ZXJ5Y2FjaGVcbiAqL1xuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5xdWVyeUNhY2hlID0gcXVlcnlDYWNoZTtcblxuLyoqXG4gKiBSZXNvbHZlcyBhbiBhc3NldCByZWZlcmVuY2UgaW50byBhbiBvYmplY3QuXG4gKlxuICogU2VlIGh0dHBzOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2ltYWdlLmh0bWwjcmVzb2x2ZWFzc2V0c291cmNlXG4gKi9cbi8qICRGbG93Rml4TWUoPj0wLjg5LjAgc2l0ZT1yZWFjdF9uYXRpdmVfaW9zX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXNcbiAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuSW1hZ2UucmVzb2x2ZUFzc2V0U291cmNlID0gcmVzb2x2ZUFzc2V0U291cmNlO1xuXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLnByb3BUeXBlcyA9IERlcHJlY2F0ZWRJbWFnZVByb3BUeXBlO1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGJhc2U6IHtcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gIH0sXG59KTtcblxuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5tb2R1bGUuZXhwb3J0cyA9IChJbWFnZTogQ2xhc3M8SW1hZ2VDb21wb25lbnRUeXBlPik7XG4iXX0=